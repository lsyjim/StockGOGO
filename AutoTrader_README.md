# AutoTrader 自動交易程式說明文件

## 版本：v1.0
## 日期：2026-01-19

---

## 一、功能概述

AutoTrader 是一個整合量化分析核心的自動交易程式，具備以下功能：

1. **雙模式架構**：模擬 (SIMULATION) / 實單 (LIVE)
2. **視覺化介面**：完整的 GUI 操作介面
3. **掃描與分析**：自動掃描自選股並執行量化分析
4. **資金控管**：預算池機制、單一部位上限
5. **交易決策**：含否決權機制的買賣訊號判斷
6. **損益監控**：即時計算總資產與報酬率
7. **存股名單**：指定股票只看不動

---

## 二、快速開始

### 2.1 視覺化介面（推薦）

```bash
# 直接執行 GUI
python auto_trader_gui.py
```

或從主程式開啟：
- 啟動 `main.py`
- 點擊左上角「🤖 自動交易」按鈕

### 2.2 命令列模式

```bash
# 模擬模式（推薦新手）
python auto_trader.py --mode SIMULATION --capital 1000000

# 只執行一次
python auto_trader.py --mode SIMULATION --once

# 調整掃描間隔
python auto_trader.py --mode SIMULATION --interval 600

# 實單模式
python auto_trader.py --mode LIVE
```

### 2.3 程式內使用

```python
from auto_trader import AutoTrader

# 模擬模式
trader = AutoTrader(mode='SIMULATION', initial_capital=1000000)
trader.run_once()  # 執行一次
trader.run()       # 持續執行

# 實單模式
trader = AutoTrader(mode='LIVE')
trader.login(user_id, password, cert_path, cert_password)
trader.run()
```

---

## 三、視覺化介面說明

### 3.1 介面佈局

```
┌─────────────────────────────────────────────────────────────────┐
│ 🔐 模式與連線                                                    │
│ [模擬模式] [實單模式]    [登入資訊...]    [🔌 連線/初始化]       │
├───────────────┬─────────────────────────┬───────────────────────┤
│ 💰 資金設定   │  📡 分析結果            │  🔒 存股名單          │
│ ───────────── │  ────────────           │  ────────────         │
│ 模擬帳戶:     │  [🔍手動分析] [▶️自動]  │  [➕新增] [➖移除]    │
│ - 初始資金    │                         │  股票代碼: [    ]     │
│ - 可用餘額    │  分析報告顯示區...      │  備註:     [    ]     │
│ [重置帳戶]    │                         │  ─────────────        │
│ ───────────── │  ════════════           │  存股列表:            │
│ 實單帳戶:     │                         │  · 2330 台積電        │
│ - 交易上限    │  📝 交易紀錄            │  · 2317 鴻海          │
│ ───────────── │  [🔄重新載入] [💾匯出]  │  ─────────────        │
│ 交易參數:     │                         │  📋 自選股清單        │
│ - 部位上限    │  交易LOG列表...         │  顯示所有自選股       │
│ - 最低RR      │                         │  及其交易狀態         │
│ [💾儲存設定]  │                         │                       │
│ ───────────── │                         │                       │
│ 📊 庫存與損益 │                         │                       │
│ [模擬] [實單] │                         │                       │
│ 總資產: $XXX  │                         │                       │
│ 損益: +$XXX   │                         │                       │
│ 報酬率: +X.X% │                         │                       │
│ ───────────── │                         │                       │
│ 庫存列表      │                         │                       │
│ 股票|股數|損益│                         │                       │
└───────────────┴─────────────────────────┴───────────────────────┘
```

### 3.2 功能區塊說明

| 區塊 | 功能 |
|------|------|
| **模式與連線** | 切換模擬/實單模式，輸入登入資訊，初始化連線 |
| **資金設定** | 調整模擬初始資金、實單交易上限、單一部位比例 |
| **庫存損益** | 切換顯示模擬/實單帳戶的持倉與損益 |
| **分析結果** | 顯示掃描分析報告、買賣訊號、執行結果 |
| **交易紀錄** | 顯示所有交易LOG，支援匯出CSV |
| **存股名單** | 新增/移除存股，加入備註說明 |
| **自選股清單** | 顯示所有自選股及其狀態（交易/存股）|

### 3.3 操作流程

```
1. 選擇模式
   ├── 模擬模式：不需登入，直接連線
   └── 實單模式：填寫登入資訊後連線

2. 連線初始化
   └── 點擊「🔌 連線/初始化」

3. 調整設定
   ├── 模擬資金（模擬模式）
   ├── 交易上限（實單模式）
   ├── 單一部位比例
   └── 最低盈虧比

4. 管理存股名單
   ├── 新增：輸入代碼 → 點擊「➕新增」
   ├── 移除：選擇項目 → 點擊「➖移除」
   └── 從自選股匯入：批次勾選

5. 執行分析
   ├── 手動：點擊「🔍手動分析」執行一次
   └── 自動：點擊「▶️開始自動」持續監控

6. 查看結果
   ├── 分析結果區：查看訊號與執行狀態
   ├── 庫存損益區：查看持倉與報酬
   └── 交易紀錄區：查看完整LOG
```

---

## 四、檔案說明

| 檔案名稱 | 說明 |
|----------|------|
| `auto_trader.py` | 核心交易邏輯 |
| `auto_trader_gui.py` | 視覺化介面 |
| `simulation_data.json` | 模擬帳戶數據 |
| `ignore_list.json` | 存股名單 |
| `trade_log.json` | 交易紀錄 |

### 4.1 simulation_data.json 結構

```json
{
  "balance": 850000,
  "inventory": {
    "2330": {
      "qty": 1000,
      "cost": 580.0,
      "buy_date": "2026-01-19T10:00:00",
      "reason": "場景B黃金買點"
    }
  },
  "initial_capital": 1000000,
  "created_at": "2026-01-19T09:00:00",
  "last_updated": "2026-01-19T10:30:00"
}
```

### 4.2 ignore_list.json 結構

```json
{
  "description": "存股黑名單 - 只看不動",
  "symbols": ["2330", "2317"],
  "notes": {
    "2330": "台積電 - 長期存股",
    "2317": "鴻海 - 定期定額"
  },
  "updated_at": "2026-01-19T00:00:00"
}
```

### 4.3 trade_log.json 結構

```json
[
  {
    "time": "2026-01-19T10:30:00",
    "action": "BUY",
    "symbol": "2330",
    "qty": 1000,
    "price": 580.0,
    "cost": 580826,
    "reason": "場景B黃金買點"
  },
  {
    "time": "2026-01-19T14:00:00",
    "action": "SELL",
    "symbol": "2330",
    "qty": 1000,
    "price": 595.0,
    "proceeds": 592219,
    "pnl": 11393,
    "reason": "觸發停利"
  }
]
```

---

## 五、決策邏輯說明

### 5.1 優先級順序

```
┌─────────────────────────────────────────┐
│         決策優先級（高 → 低）           │
├─────────────────────────────────────────┤
│ 1. 賣出訊號（最高優先）                 │
│    └─ 停損/停利/場景D/放量跌破          │
│                                         │
│ 2. 否決權檢查（阻擋買進）               │
│    ├─ 場景A過熱                         │
│    ├─ 信心度不足                        │
│    ├─ 被濾網降級                        │
│    ├─ RR < 1.5                          │
│    └─ RSI > 80                          │
│                                         │
│ 3. 買進訊號                             │
│    ├─ 場景B/B2 黃金買點                 │
│    ├─ 左側買訊（超跌反彈）              │
│    └─ 帶量突破（VP05）                  │
└─────────────────────────────────────────┘
```

### 5.2 賣出條件（任一觸發）

| 條件 | 說明 |
|------|------|
| 停損觸發 | 現價 ≤ 停損價 |
| 停利觸發 | 現價 ≥ 停利價 |
| 場景 D | 空頭確認 |
| 左側賣訊 | 過熱回檔 |
| 量價賣訊 | 放量跌破 / 跳空下跌 |

### 5.3 買進條件

| 條件 | 說明 |
|------|------|
| 場景 B/B2 | 黃金買點 |
| 左側買訊 | 超跌反彈 |
| 帶量突破 | VP05 訊號 |
| 強力建議 | STRONG_BUY |

### 5.4 否決條件（任一觸發則放棄買進）

| 條件 | 說明 |
|------|------|
| 場景 A | 多頭過熱 |
| 信心度不足 | Confidence ≠ High |
| 被降級 | Downgraded = True |
| 盈虧比差 | RR < 1.5 |
| RSI 超買 | RSI > 80 |

---

## 六、資金控管機制

### 6.1 預算池

```
可用預算 = min(帳戶餘額, MAX_BUDGET - 目前持倉成本)
```

- `MAX_INVESTMENT_BUDGET`: 50 萬（可在 GUI 調整）
- `MAX_SINGLE_POSITION_PCT`: 20%（單一部位上限）

### 6.2 交易成本

| 項目 | 費率 |
|------|------|
| 手續費（買+賣）| 0.1425% × 2 |
| 交易稅（賣）| 0.3% |
| 總計（單次來回）| ~0.585% |

---

## 七、設定調整

### 7.1 GUI 設定

在視覺化介面中可直接調整：
- 模擬初始資金
- 實單交易上限
- 單一部位比例
- 最低盈虧比
- 掃描間隔

### 7.2 程式碼設定

在 `auto_trader.py` 的 `AutoTraderConfig` 類別：

```python
class AutoTraderConfig:
    # 資金設定
    DEFAULT_INITIAL_CAPITAL = 1_000_000  # 初始資金
    MAX_INVESTMENT_BUDGET = 500_000       # 最大預算
    MAX_SINGLE_POSITION_PCT = 0.20        # 單一部位上限
    
    # 決策設定
    MIN_RR_RATIO = 1.5                    # 最低盈虧比
    
    # 掃描間隔
    SCAN_INTERVAL = 300                   # 5 分鐘
```

---

## 八、注意事項

1. **模擬模式**
   - 程式重啟後，模擬倉位會保留
   - 若要重新開始，點擊「重置帳戶」或刪除 `simulation_data.json`

2. **實單模式**
   - 需要安裝 `fubon_neo` SDK
   - 需要有效的憑證檔案
   - 建議先在模擬模式充分測試

3. **存股名單**
   - 在名單中的股票只會分析，不會自動交易
   - 可加入備註說明持有原因

4. **市場時段**
   - 程式不會自動判斷開盤時間
   - 建議配合排程工具在交易時段執行

---

## 九、常見問題

### Q1: 如何清除模擬數據重新開始？

在 GUI 中點擊「重置帳戶」，或手動刪除：
```bash
rm simulation_data.json
```

### Q2: 如何管理存股名單？

在 GUI 右側「存股名單」區塊：
- 新增：輸入股票代碼 → 點擊「➕新增」
- 移除：選擇列表項目 → 點擊「➖移除」
- 批次：點擊「從自選股匯入」勾選

### Q3: 為什麼有買訊但沒有執行？

可能原因：
1. 資金不足
2. 被否決條件阻擋
3. 在存股名單中

查看分析結果區的詳細說明。

### Q4: 如何查看交易紀錄？

- GUI：中間「交易紀錄」區塊
- 匯出：點擊「💾匯出CSV」
- 原始檔案：`trade_log.json`

---

## 十、版本歷史

| 版本 | 日期 | 更新內容 |
|------|------|----------|
| v1.0 | 2026-01-19 | 初版發布，含 GUI 介面 |
